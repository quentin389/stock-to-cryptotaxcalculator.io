# Stock To cryptotaxcalculator.io (UK only)

## Warnings
* I do not guarantee that anything here will work or will be HMRC-compliant.
* I have created this based on my transactions files.
  Many things are not implemented.
* Do not upload multiple manual files covering the same transactions or re-upload
  the same file in cryptotaxcalculator.io. This may mess things up.
  Delete the old file first, then add the new one.

## Purpose

UK taxes are, in the simplest situation, the same for crypto and stock.

This set of scripts parses stock transaction files from several example
stock exchanges formats to cryptotaxcalculator.io "Advanced Manual CSV" format,
by making the stock appear as custom coins and faking some transaction types
in order to trick the calculator into doing your stock taxes along with the crypto
taxes. Magic!

This is done solely for my own needs, with file formats I had available at the time
of the making, works only in the UK, and you should never do anything with your
taxes without consulting your accountant or making SURE you know the tax code.

## Correct file formats

Please note that in many places I throw errors if the files being parsed are not
**exactly** in the same format as the files I had as examples. That is because
I can't predict or assume that some variation means something specific without
analysing it. So it's better to say "stop, I don't know what is this" than allow
a deviation and produce random output.

This means that it's possible that almost any new file being parsed will throw
an error.

Also, keep in mind that cryptotaxcalculator.io format and rules also change,
so even with source files in correct format, in time something may change and
stop producing desired effects.

## Available Conversions

This parser accepts the following formats:
* eToro XLS format: `etoro-account-statement-*.xlsx` files. This source file has to
  be generated using the "xls" button on eToro "Account statement" page.
* IBKR (Interactive Brokers) CSV format: `accountId_dateOne_dateTwo.csv`. This
  source file has to be generated from the "Statements" section, by selecting
  "Activity" with "CSV" format.
* IG (ig.com) CSV format.
  * Share dealing. This requires two files: `TransactionHistory-*.csv` and
    `TradeHistory.csv`. It's best to rename the second file, so it also includes
    the dates. The files can be generated by going to "History" for both types.
    Please note that Transaction History has to include dates between the first
    transaction you want to include and the date of the settlement of the last
    transaction. This means that if you parse several consecutive files, some
    money transfers from overlapping periods may be repeated, and you will have
    to fix it yourself by hand, if you care about accurate currency data.
  * CFDs. There is only one file needed as this uses a simplified parsing method
    where only closing trades are recorded (e.g. some account fees may be skipped).
    To obtain the file, go to the History tab of a CFD Trading account and select
    "Profit/loss breakdown". Only closed positions are relevant, opening positions
    can be present in the file, but will be ignored. The file will have a format of
    `TradeBreakDown-(dateFrom)-(dateTo).cfd`
* Schwab for vesting equity awards. Requires transaction history CSV for both
  Equity Award Center and the Brokerage account the shares were deposited to.
  The equity award file has to be specified as a `--second_source` argument.

Latest tax year for which given formats are confirmed to be working:
* eToro - 2021-22
* IG - 2021-22
* IBKR - 2023-24
* Schwab - 2023-24

## How to use

* Install python and poetry
* Run `poetry install`
* Run `poetry run python import.py -h`
